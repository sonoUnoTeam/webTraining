{% extends "base.html" %}
{% load i18n %}
{% load custom_filters %}

{% block content %}
<style>
    .training-link {
        color: #007bff;
        text-decoration: none;
        transition: color 0.2s;
    }
    body.dark-mode .training-link {
        color: #6eb5d4;
    }
    .training-link:hover {
        color: #0056b3;
        text-decoration: underline;
    }
    body.dark-mode .training-link:hover {
        color: #88c5db;
    }
    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }
    body.dark-mode .table-hover tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.075);
    }
    .table td {
        vertical-align: middle;
    }
    .status-completed {
        color: #28a745;
        font-weight: bold;
    }
    body.dark-mode .status-completed {
        color: #75b798;
    }
    .status-available {
        color: #17a2b8;
        font-weight: bold;
    }
    body.dark-mode .status-available {
        color: #6eb5d4;
    }
    .status-locked {
        color: #6c757d;
        font-weight: bold;
    }
    body.dark-mode .status-locked {
        color: #adb5bd;
    }
    .exam-btn {
        background-color: #28a745;
        border-color: #28a745;
        transition: background-color 0.2s;
    }
    .exam-btn:hover {
        background-color: #218838;
        border-color: #218838;
    }
    .exam-btn:disabled {
        background-color: #6c757d;
        border-color: #6c757d;
    }
    .note-card {
        background-color: #f8f9fa;
        border-left: 5px solid #007bff;
    }
    body.dark-mode .note-card {
        background-color: #212529 !important;
        border-left: 5px solid #6eb5d4 !important;
    }
    .note-card .card-header {
        color: #007bff;
        font-weight: bold;
    }
    body.dark-mode .note-card .card-header {
        color: #6eb5d4;
        background-color: #2b3035;
    }
    /* Title styles */
    .page-title {
        font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        font-weight: 700;
        font-size: 1.75rem;
        color: #0b5ed7;
        margin-bottom: 0.35rem;
        letter-spacing: -0.1px;
    }
    body.dark-mode .page-title {
        color: #6eb5d4;
    }
    .section-title {
        font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        font-weight: 650;
        font-size: 1.2rem;
        color: #1f2a37;
        margin-bottom: 0.65rem;
        padding-bottom: 0.25rem;
        border-bottom: 2px solid rgba(13,110,253,0.08);
    }
    body.dark-mode .section-title {
        color: #f8f9fa;
        border-bottom: 2px solid rgba(110, 181, 212, 0.2);
    }
    /* Hero and description */
    .course-hero {
        background: linear-gradient(135deg, #fafdff 0%, #f3f7ff 100%);
        border: 1px solid #e4e9f3;
        border-radius: 10px;
        padding: 1rem;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.03);
        margin-bottom: 0.75rem;
    }
    body.dark-mode .course-hero {
        background: linear-gradient(135deg, #2b3035 0%, #1a1d20 100%);
        border: 1px solid #495057;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
    }
    .course-description {
        font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        font-size: 1.02rem;
        line-height: 1.55;
        color: #3d4551;
        margin: 0.25rem 0 0;
    }
    body.dark-mode .course-description {
        color: #dee2e6;
    }
    .card.note-card {
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }
    body.dark-mode .card.note-card {
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    /* Table styles */
    .table thead tr {
        font-weight: 600;
    }
    body.dark-mode .table {
        color: #f8f9fa;
    }
    body.dark-mode .table thead th {
        color: #f8f9fa;
        border-color: #495057;
    }
    body.dark-mode .table tbody td {
        color: #dee2e6;
        border-color: #495057;
    }
    body.dark-mode .table-primary {
        background-color: #2b4c6f !important;
        color: #f8f9fa !important;
    }
    body.dark-mode .table-primary th {
        background-color: #2b4c6f !important;
        color: #f8f9fa !important;
    }
    body.dark-mode .table-success {
        background-color: #1e4b33 !important;
        color: #f8f9fa !important;
    }
    body.dark-mode .table-success th {
        background-color: #1e4b33 !important;
        color: #f8f9fa !important;
    }
    body.dark-mode .table-striped > tbody > tr:nth-of-type(odd) {
        background-color: rgba(255, 255, 255, 0.05);
    }
    body.dark-mode .table-bordered {
        border-color: #495057;
    }
    body.dark-mode .table-hover tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.075);
    }
</style>

<div>
    <div class="course-hero">
        <h1 class="page-title mb-2">{{ course.name_course }}</h1>
        <p class="course-description">{{ course.description }}</p>
    </div>
    <div class="card my-3 border border-3 note-card">
        <div class="card-header">
            {% trans "Quick Guide" %}
        </div>
        <div class="card-body">
            <blockquote class="blockquote mb-0">
                {% blocktrans %}
                <p>Trainings unlock sequentially after completing the previous one. Click the training name to start, you can view the results once the training is completed. The final training unlocks after completing all trainings in the course.</p>
                {% endblocktrans %}
            </blockquote>
        </div>
    </div>

    <h2 class="section-title">{% trans "Course Modules" %}</h2>
    <div class="table-responsive">
        {% if course_trainings %}
            <table class="table table-striped table-bordered border border-2 table-hover">
                <thead>
                    <tr class="table-primary">
                        <th>{% trans "Order" %}</th>
                        <th>{% trans "Name" %}</th>
                        <th>{% trans "Difficulty" %}</th>
                        <th>{% trans "Duration (minutes)" %}</th>
                        <th>{% trans "Allowed Attempts" %}</th>
                        <th>{% trans "Attempts Made" %}</th>
                        <th>{% trans "Reviews" %}</th>
                        <th>{% trans "Status" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ct in course_trainings %}
                        <tr>
                            <td>{{ ct.order }}</td>
                            <td>
                                {% if ct.enabled %}
                                    <a href="{% url 'trainingApp:block_deploy_list' course.id ct.training.id %}" class="training-link">{{ ct.training.name_training }}</a>
                                {% else %}
                                    {{ ct.training.name_training }}
                                {% endif %}
                            </td>
                            <td>{{ ct.training.get_difficulty_display }}</td>
                            <td>{{ ct.training.total_estimated_duration }}</td>
                            <td>{{ ct.training.attempts_allowed }}</td>
                            <td>{{ num_trainee_trainings|get_value:ct.training.id }}</td>
                            <td>
                                <a href="{% url 'trainingApp:review_list_tt' course.id ct.training.id %}" class="text-primary">{% trans "review" %}</a>
                            </td>
                            <td>
                                {% if ct.completed %}
                                    <span class="status-completed">{% trans "Completed" %}</span>
                                {% elif ct.enabled %}
                                    <span class="status-available">{% trans "Available" %}</span>
                                {% else %}
                                    <span class="status-locked">{% trans "Locked - Complete previous trainings" %}</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            {% blocktrans %}
                <p class="lead">No trainings in this course.</p>
            {% endblocktrans %}
        {% endif %}
    </div>

    <h2 class="section-title">{% trans "Final Training" %}</h2>
    <div class="table-responsive">
        <table class="table table-striped table-bordered border border-2 table-hover">
            <thead>
                <tr class="table-success">
                    <th>{% trans "Name" %}</th>
                    <th>{% trans "Difficulty" %}</th>
                    <th>{% trans "Duration (minutes)" %}</th>
                    <th>{% trans "Allowed Attempts" %}</th>
                    <th>{% trans "Attempts Made" %}</th>
                    <th>{% trans "Reviews" %}</th>
                    <th>{% trans "Status" %}</th>
                    <th>{% trans "Action" %}</th>
                </tr>
            </thead>
            <tbody>
                {% if course.final_exam %}
                    <tr>
                        <td>{{ course.final_exam.name_training }}</td>
                        <td>{{ course.final_exam.get_difficulty_display }}</td>
                        <td>{{ course.final_exam.total_estimated_duration }}</td>
                        <td>{{ course.final_exam.attempts_allowed }}</td>
                        <td>{{ num_trainee_trainings|get_value:course.final_exam.id }}</td>
                        <td>
                            <a href="{% url 'trainingApp:review_list_tt' course.id course.final_exam.id %}" class="text-primary">{% trans "review" %}</a>
                        </td>
                        <td>
                            {% if trainee_course.exam_passed %}
                                <span class="status-completed">{% trans "Passed" %}</span>
                            {% elif all_completed %}
                                <span class="status-available">{% trans "Available" %}</span>
                            {% else %}
                                <span class="status-locked">{% trans "Locked - Complete all trainings" %}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if all_completed %}
                                <a href="{% url 'trainingApp:block_deploy_list' course.id course.final_exam.id %}" class="btn exam-btn">{% trans "Take Exam" %}</a>
                            {% else %}
                                <span class="btn exam-btn disabled">{% trans "Take Exam" %}</span>
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="8">{% trans "No final training defined for this course." %}</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}