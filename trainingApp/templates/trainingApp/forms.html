{% extends "base.html" %}
{% load i18n %}
{% block content %} 

    <script>
        function validateAndSubmitForm() {
        // Realizar validación del formulario
        var form = document.getElementById('myForm');
        if (!form.checkValidity()) {
            // Si la validación falla, muestra los mensajes de error nativos del navegador
            form.reportValidity();
            return;
        }

        // Si la validación es exitosa, muestra el cuadro de diálogo de confirmación
        confirmation();
        }

        function confirmation() {
            // Detectar si está en modo oscuro
            const isDarkMode = document.body.classList.contains('dark-mode');
            
            Swal.fire({
                title: "{% trans 'Are you sure?' %}",
                text: "{% trans 'Your answer will be submitted.' %}",
                icon: "question",
                showCancelButton: true,
                confirmButtonText: "{% trans 'Confirm' %}",
                cancelButtonText: "{% trans 'Cancel' %}",
                background: isDarkMode ? '#2b3035' : '#fff',
                color: isDarkMode ? '#e9ecef' : '#212529',
                customClass: {
                    popup: isDarkMode ? 'swal-dark-mode' : ''
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // Si el usuario confirma, enviar el formulario
                    document.getElementById('myForm').submit();
                }
            });
        }
    </script>
    <style>
        .form-deploy-image {
            text-align: left;
            margin-bottom: 0.75rem;
        }
        .form-deploy-image img {
            max-width: 100%;
            max-height: 350px;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .form-deploy-image .bg-light {
            border-radius: 8px;
        }
        .form-deploy-audio {
            margin-bottom: 0.75rem;
        }
        .form-deploy-audio audio {
            width: 100%;
            max-width: 600px;
        }
        .form-question {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }
        .form-question p {
            margin: 0;
            font-size: 1rem;
            font-weight: 500;
            line-height: 1.4;
            color: #212529;
        }
        .form-choice {
            margin-bottom: 0.75rem;
        }
        .form-choice legend {
            font-size: 0.95rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.5rem;
        }
        .form-choice ul {
            list-style: none;
            padding-left: 0;
        }
        .form-choice li {
            margin-bottom: 0.5rem;
        }
        .form-actions {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
        }
        .choice-row {
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            border: 2px solid #e9ecef;
            background-color: #fff;
        }
        .choice-row:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        .choice-row.selected {
            background-color: rgba(0, 123, 255, 0.1);
            border-color: #007bff;
        }
        .choice-row label {
            cursor: pointer;
            margin: 0;
            font-size: 1rem;
            line-height: 1.5;
            display: flex;
            align-items: center;
            width: 100%;
        }
        .choice-row input[type="radio"] {
            margin-right: 0.75rem;
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
        }
        .progress-indicator {
            font-size: 0.9rem;
            font-weight: 500;
            color: #6c757d;
            padding: 0.5rem 1rem;
            background-color: #f8f9fa;
            border-radius: 20px;
            border: 1px solid #dee2e6;
        }
        fieldset.border {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        }
        
        /* Dark mode styles */
        body.dark-mode .form-question {
            background-color: #2b3035;
            border-left-color: #6eb5d4;
        }
        body.dark-mode .form-question p {
            color: #f8f9fa;
        }
        body.dark-mode .form-choice legend {
            color: #f8f9fa;
        }
        body.dark-mode .choice-row {
            background-color: #343a40;
            border-color: #495057;
            color: #f8f9fa;
        }
        body.dark-mode .choice-row:hover {
            background-color: #495057;
            border-color: #6eb5d4;
        }
        body.dark-mode .choice-row.selected {
            background-color: rgba(110, 181, 212, 0.2);
            border-color: #6eb5d4;
        }
        body.dark-mode .choice-row label {
            color: #f8f9fa;
        }
        body.dark-mode .progress-indicator {
            background-color: #343a40;
            border-color: #495057;
            color: #adb5bd;
        }
        body.dark-mode fieldset.border {
            border-color: #495057 !important;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        body.dark-mode .bg-light {
            background-color: #2b3035 !important;
        }
        body.dark-mode .text-muted {
            color: #adb5bd !important;
        }
        body.dark-mode .form-actions {
            border-top-color: #495057;
        }
        
        /* SweetAlert2 dark mode */
        .swal-dark-mode {
            border: 1px solid #495057 !important;
        }
        body.dark-mode .swal2-icon.swal2-question {
            border-color: #6eb5d4 !important;
            color: #6eb5d4 !important;
        }
    </style>

    <fieldset class="border p-3 rounded">
            <form id="myForm" method="POST" action="{% url 'trainingApp:forms' course_id training_id block_id %}">

                {% csrf_token %}
                {% if form.instance.deploy_image and form.instance.deploy_image.name %}
                <div class="form-deploy-image">
                    <img src="{{ form.instance.deploy_image.url }}" alt="{{ form.instance.question|default:_('Deploy image') }}" loading="lazy">
                </div>
                {% endif %}
                
                {% if form.instance.deploy_sound and form.instance.deploy_sound.name %}
                <div class="form-deploy-audio">
                    <audio controls>
                        <source  src="{{ form.instance.deploy_sound.url }}" type="audio/mpeg">
                        {% blocktrans %} Your browser does not support audio playback. {% endblocktrans %}
                    </audio>
                </div>
                {% endif %}
                
                <div class="form-question">
                    <p class="h5">{{ form.instance.question}}</p>
                </div>
                <div class="form-choice">
                    <fieldset>
                        <legend>{% trans 'Select Answer' %}</legend>
                        <ul id="choices-list">
                            {% for field in form.visible_fields %}
                                <li class="choice-row">
                                    {{ field }}
                                </li>
                            {% endfor %}
                        </ul>
                    </fieldset>
                </div>
                
                <div class="form-actions d-flex flex-column flex-md-row align-items-center justify-content-between gap-3">
                    <div class="d-flex gap-2">
                        <!--  Botón para enviar el formulario -->
                        <button onclick="validateAndSubmitForm()" type="button" class="btn btn-primary">
                            {% trans 'Send and Next' %}
                        </button>
                        
                        <!-- Botón para volver al anterior deploy -->
                        <a href="{% url 'trainingApp:back_deploy' course_id training_id block_id %}" class="btn btn-outline-secondary">
                            {% trans 'Back' %}
                        </a>
                    </div>
                    <div class="progress-indicator">
                        {% trans "Question" %} {{ current_deploy_index|add:1 }} / {{ deploys_count }}
                    </div>
                </div>
            </form>
        </fieldset>
 
{% endblock %}
